<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Map App</title>
        <style>
            html,
            body {
                margin: 0;
            }
            #map {
                height: 70vh;
                width: 70vw;
            }
            #topbar {
            }
        </style>
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <script
            src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>

        <!-- Leaflet Awesome Markers -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"
            integrity="sha512-cUoWMYmv4H9TGP4hbm1mIjYo90WzIQFo/5jj+P5tQcDTf+iVR59RyIj/a9fRsBxzxt5Dnv/Ex7MzRIxcDwaOLw=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.min.js"
            integrity="sha512-8BqQ2RH4L4sQhV41ZB24fUc1nGcjmrTA6DILV/aTPYuUzo+wBdYdp0fvQ76Sxgf36p787CXF7TktWlcxu/zyOg=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
    </head>
    <body>
        <div id="app">
            <div id="topbar">
                <label for="category-select">Category</label>
                <select id="category-select"></select>
                <button onclick="clearCategoryFilter">clear</button>
            </div>
            <div id="map"></div>
        </div>
        <script>
            function clearCategoryFilter() {
                categoryFilter = null;
                filterByCategory();
            }
            function filterByCategory() {
                markers.forEach((marker) => {
                    if (
                        categoryFilter === null ||
                        marker.category === categoryFilter
                    ) {
                        marker.addTo(map);
                    } else {
                        marker.remove();
                    }
                });
            }

            const categories = new Map([
                ["Stores & Shops", "red"],
                ["Flea Markets", "purple"],
                ["Events & Pop-Ups", "green"],
                ["Recycling & Collection Points", "blue"],
                ["Educational & Awareness Spaces", "pink"],
                ["Collaborative Spaces", "orange"],
                ["Local Initiatives & Collaborations", "darkgreen"],
            ]);

            const data = [
                {
                    name: "IKIEL",
                    category: "Stores & Shops",
                    address: "Kaiserstrasse 68 1070",
                    latitude: 48.203839,
                    longitude: 16.340357,
                    opening_hours: "Mo-Sa: 12-18",
                    price_range: "",
                    google_maps_link:
                        "https://maps.app.goo.gl/DQWjASux2Z5uquBd6",
                },
                {
                    name: "Flea market",
                    category: "Flea Markets",
                    address: "Schottenfeldgasse 29/2",
                    latitude: 48.19966,
                    longitude: 16.342906559703767,
                    opening_hours: "Tue&Thurs:10-12 & 13-17",
                    price_range: "",
                    google_maps_link:
                        "https://maps.app.goo.gl/6yoUh7XjMQUzQ7Sq5",
                },
                {
                    name: "Wiener Hilfswerk",
                    category: "Recycling & Collection Points",
                    address: "Schottenfeldgasse 29",
                    latitude: 48.199792,
                    longitude: 16.342992,
                    opening_hours: "Mo-Fr 8-16",
                    price_range: "",
                    google_maps_link:
                        "https://maps.app.goo.gl/W3a84CENazNTYrYR6",
                },
                {
                    name: "Ebenberg",
                    category: "Stores & Shops",
                    address: "Neubaugasse 4",
                    latitude: 48.198709,
                    longitude: 16.350012,
                    opening_hours: "Mo-Fr 11-19",
                    price_range: "",
                    google_maps_link:
                        "https://maps.app.goo.gl/mXnfEiVgUdZe8CK58",
                },
                {
                    name: "Zweitkleid7",
                    category: "Stores & Shops",
                    address: "Westbahnstaße 7",
                    latitude: 48.201674,
                    longitude: 16.346763,
                    opening_hours: "Tue-Fri: 11-18 Sat 11-15",
                    price_range: "",
                    google_maps_link:
                        "https://maps.app.goo.gl/ZrxiMFnnaDwtc2738",
                },
                {
                    name: "GuterStoff",
                    category: "Stores & Shops",
                    address: "Lindengasse 28",
                    latitude: 48.200426,
                    longitude: 16.351175,
                    opening_hours: "Di-Fr 12-18.30, Sat 11-17",
                    price_range: "18-70 €",
                    google_maps_link:
                        "https://maps.app.goo.gl/HJwjzBhtmKurNiQC8",
                },
                {
                    name: "herr und frau klein",
                    category: "Stores & Shops",
                    address: "Kirchengasse 7",
                    latitude: 48.200278,
                    longitude: 16.352365,
                    opening_hours: "Mo-Sat 10-18",
                    price_range: "14-1270 €",
                    google_maps_link:
                        "https://maps.app.goo.gl/Cx2Yz23FULydSCWBA",
                },
                {
                    name: "zerum",
                    category: "Stores & Shops",
                    address: "Kirchengasse 13",
                    latitude: 48.2012387,
                    longitude: 16.3517222,
                    opening_hours: "Mo-Fr 10-19, Sat 10-18",
                    price_range: "24-250 €",
                    google_maps_link:
                        "https://maps.app.goo.gl/kkc7L5gUs1h6Feia7",
                },
                {
                    name: "Glein",
                    category: "Stores & Shops",
                    address: "Neustiftgasse 18",
                    latitude: 48.205465,
                    longitude: 16.3344797,
                    opening_hours: "Mo-Sat 12-18",
                    price_range: "30-2000 €",
                    google_maps_link:
                        "https://maps.app.goo.gl/tkMgmVwkMGX4hykZA",
                },
                {
                    name: "OTOTO Store & Coffee",
                    category: "Stores & Shops",
                    address: "Zieglergasse 38",
                    latitude: 48.2016083,
                    longitude: 16.3426458,
                    opening_hours: "Mo-Fr 8-19, Sat 9-18",
                    price_range: "",
                    google_maps_link:
                        "https://maps.app.goo.gl/BfMJXAtogBjkDRaMA",
                },
                {
                    name: "Freitag Store Wien",
                    category: "Stores & Shops",
                    address: "Neubaugasse 26",
                    latitude: 48.20050357,
                    longitude: 16.34955456,
                    opening_hours: "",
                    price_range: "",
                    google_maps_link:
                        "https://maps.app.goo.gl/cwtd3V5b8ts62Ca8A",
                },
                {
                    name: "7stern Flohmarkt",
                    category: "Flea Markets",
                    address: "Siebensterngasse 31",
                    latitude: 48.20200555,
                    longitude: 16.35152762,
                    opening_hours: "Sat-Sun 12-18 (monthly)",
                    price_range: "",
                    google_maps_link:
                        "https://maps.app.goo.gl/CXkDtQd59jgqFsgC8",
                },
            ];
            const map = L.map("map").setView([48.2081, 16.3713], 13);
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                maxZoom: 19,
                attribution:
                    '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            }).addTo(map);

            const categorySelect = document.getElementById("category-select");
            for (const [name, color] of categories.entries()) {
                const option = document.createElement("option");
                option.value = name;
                option.textContent = name;
                categorySelect.appendChild(option);
            }

            const markers = [];
            data.forEach((location) => {
                const categoryColor =
                    categories.get(location.category) ?? "gray";

                const customMarker = L.AwesomeMarkers.icon({
                    icon: "info-sign",
                    markerColor: categoryColor,
                    prefix: "glyphicon",
                });

                const marker = L.marker(
                    [location.latitude, location.longitude],
                    {
                        icon: customMarker,
                        riseOnHover: true,
                    }
                )
                    .addTo(map)
                    .bindPopup(
                        `<b>${location.name}</b><br>${location.address}<br>${location.opening_hours}<br><a href=${location.google_maps_link}>Google Maps</a>`
                    );
                marker.category = location.category;
                markers.push(marker);
            });

            let categoryFilter = null;

            categorySelect.addEventListener("change", (e) => {
                categoryFilter = e.target.value;
                filterByCategory();
            });
        </script>
    </body>
</html>
